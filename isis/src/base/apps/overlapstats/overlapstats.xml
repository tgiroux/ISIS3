<?xml version="1.0" encoding="UTF-8"?>

<application name="overlapstats" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">

  <brief>Calculates the statistics of overlapping cube regions</brief>

  <description>
    <p>
    This application takes a list of cubes and an image overlap list file from
    the output of
    <a href="../findimageoverlaps/findimageoverlaps.html" target="_blank">
    findimageoverlaps</a> and calculates statistics on all overlapping polygons
    of the provided images, writing the results to an output file. The
    statistics generated by this application may provide useful information
    for choosing parameters for the
    <a href="../autoseed/autoseed.html" target="_blank">
    autoseed</a> application. Images must be ingested into ISIS and have
    <a href="../spiceinit/spiceinit.html" target="_blank">spiceinit</a>,
    <a href="../footprintinit/footprintinit.html" target="_blank">
    footprintinit</a>, and 
    <a href="../findimageoverlaps/findimageoverlaps.html" target="_blank">
    findimageoverlaps</a> run to produce the input for this application.
    </p>
    <p>
     Statistics for the area, <def>polygon thickness</def>, and image stack
     size of the polygons are calculated. These statistics include minimum,
     maximum, average, standard deviation, and variance. Area refers to the area
     of the polygon in square meters. Image stack is the number of images that
     overlap for a given overlap region.
    </p>
    <p>
    If there are any cubes within the list that do not overlap with
    any other cube in the list, those cube's filenames are included at the end
    of the output in the NoOverlap PVL keyword.
    </p>
  </description>

  <category>
    <categoryItem>Control Networks</categoryItem>
  </category>

   <history>
    <change name="Christopher Austin" date="2008-09-30">
      Original version
    </change>
    <change name="Christopher Austin" date="2008-10-28">
      Fixed the formatting for a  tab tabletype, improved documentation, and
      added an example.
    </change>
    <change name="Christopher Austin" date="2008-11-10">
      The output file TO must now be specified.
    </change>
    <change name="Steven Lambright" date="2008-11-17">
      Added support for image overlap files, which is what "OVERLAPLIST" needs
      to be. This is a required parameter obtained from running
      "findimageoverlaps."
    </change>
    <change name="Christopher Austin" date="2008-10-28">
      Added error throwing when there are no overlaps among the cubes provided
      and other small bug fixes.
    </change>
    <change name="Christopher Austin" date="2009-01-26">
      Added the ERRORS flat file.
    </change>
    <change name="Christopher Austin" date="2009-02-17">
      Added the DETAILS FULL output option. BRIEF is now what the application
      use to result in.
    </change>
    <change name="Christopher Austin" date="2009-03-05">
      Altered the DETAILS FULL and BRIEF options based off of user input. Now,
      the statistical data will always be placed in the print.prt file, and the
      TO file will only be used for the detailed output of the overlaps.
    </change>
    <change name="Christopher Austin" date="2009-06-05">
      Added the SINGLELINE parameter and changed the keywords SerialNumber* to
      ImageStack*
    </change>
    <change name="Christopher Austin" date="2009-06-08">
      Removed the *Sum keywords from the BRIEF output, and added PolygonCount.
    </change>
    <change name="Jai Rideout" date="2011-09-26">
      Updated and rewrote much of the existing documentation with Raad Saleh and
      Laszlo Kestay to match the current behavior of the application, as well as
      clarify the purpose of the application.
    </change>
    <change name="Jai Rideout" date="2011-12-26">
      Added check to ensure the provided cube list is the same one used in
      findimageoverlaps (i.e. the serial numbers in the overlap list match
      the serial numbers in the provided cube list). Fixes #515.
    </change>
    <change name="Jai Rideout" date="2012-01-18">
      The errors file now contains a newline at the end. The error count is now
      calculated regardless of whether or not the ERRORS parameter was
      specified.
    </change>
    <change name="Debbie A. Cook" date="2012-12-10">
      Changed to use TProjection instead of Projection.  References #775
    </change>
    <change name="Jeannie Backer" date="2016-04-22">
      Modified code to get TargetRadii using the cube label and mapping group rather than just the
      TargetName. Added TargetName keyword to Mapping group. References #3892
    </change>
  </history>

  <groups>
    <group name="Input Files">
      <parameter name="FROMLIST">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          The list of input cubes
        </brief>
        <description>
          The filename of a list of input cubes. This list should be the same as
          the list used by 
          <a href="../findimageoverlaps/findimageoverlaps.html" target="_blank">
          findimageoverlaps</a>.
        </description>
        <filter>
          *.lis
        </filter>
      </parameter>

      <parameter name="OVERLAPLIST">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          The list of image overlaps corresponding to the list of input cubes
        </brief>
        <description>
          The filename of the image overlap list. You can obtain
          this file by running the
          <a href="../findimageoverlaps/findimageoverlaps.html" target="_blank">
          findimageoverlaps</a> application on the list of input cubes.
        </description>
        <filter>
          *
        </filter>
      </parameter>
    </group>

    <group name="Output">
      <parameter name="DETAIL">
        <type>string</type>
        <default>
          <item>BRIEF</item>
        </default>
        <brief>
          Option to choose beetween brief and full output of statistics.
        </brief>
        <description>
          Determines how much detail is given in the output.
        </description>
        <list>
          <option value="BRIEF">
            <brief>Brief table</brief>
            <description>
              The ouput will be displayed on the screen and placed in the
              print.prt file. The output will contain a table of statistics as
              described in the application description, including Area and
              Thickness statistics. If there are any cubes in the FROMLIST which
              do not overlap any other cubes in the FROMLIST, they will be
              listed at the bottom of the output. The number of polygons is also
              recorded.
            </description>
            <exclusions>
              <item>TO</item>
              <item>TABLETYPE</item>
              <item>SINGLELINE</item>
            </exclusions>
          </option>
          <option value="FULL">
            <brief>Full data</brief>
            <description>
              In addition to the output of BRIEF, each overlap's Area,
              Thickness, and all cubes that make up the overlap are written to
              the file specified in the TO option. The format of the output can
              be specified with the TABLETYPE option.
            </description>
            <inclusions>
              <item>TO</item>
              <item>TABLETYPE</item>
            </inclusions>
          </option>
        </list>
      </parameter>

      <parameter name="TO">
        <type>filename</type>
        <fileMode>output</fileMode>
        <brief>
          FULL output filename
        </brief>
        <description>
          The filename of the output file to contain the detailed stats of each
          overlap.
        </description>
      </parameter>

      <parameter name="TABLETYPE">
        <type>string</type>
        <default>
          <item>CSV</item>
        </default>
        <brief>Data format of output file</brief>
        <description>
          The output table written to the file specified by the TO option will
          be formatted in accordance with the following option.
        </description>
        <list>
          <option value="TAB">
            <brief>Tab Table</brief>
            <description>
              Places the resulting statistics into a table where each value is
              separated by a tab. This format is easier to read by eye than CSV
              output.
            </description>
            <exclusions>
              <item>SINGLELINE</item>
            </exclusions>
          </option>
          <option value="CSV">
            <brief>Comma Separated Value Table</brief>
            <description>
              Places the resulting statistics into a table where each value is
              separated by a comma.
            </description>
            <inclusions>
              <item>SINGLELINE</item>
            </inclusions>
          </option>
        </list>
      </parameter>

      <parameter name="SINGLELINE">
        <type>boolean</type>
        <default><item>TRUE</item></default>
        <brief>
          Place all cube serial numbers on the same CVS line
        </brief>
        <description>
          Places all <def link="Cube Serial Number">cube serial numbers</def>
          and filenames on the same line in the output file. When False, Serial
          Numbers and Filenames are placed in columns for better human
          readability. This option is only available when the output is in CSV
          format.
        </description>
      </parameter>

      <parameter name="ERRORS">
        <type>filename</type>
        <fileMode>output</fileMode>
        <internalDefault>No Error Output</internalDefault>
        <brief>
          Output errors file
        </brief>
        <description>
          This file will contain the errors that occurred while calculating the
          overlap statistics. Each line will contain the error message followed
          by the serial number(s) of the cube(s) involved.
        </description>
      </parameter>
    </group>
  </groups>

  <examples>
    <example>
      <brief>Overlapping Statistics</brief>
      <description>
        This example illustrates how to generate overlap statistics for the
        following list of three overlapping cubes. overlapstats will calculate
        the thickness, area, and image count for each of the overlapping
        polygons that the cubes provided in cubes.lis create, and output these
        results to stats.txt. Each value in the resulting table will be
        separated by a tab.
      </description>
      <terminalInterface>
        <commandLine>FROMLIST=cubes.lis OVERLAPLIST=overlaps.lis DETAIL=FULL
          TO=stats.txt TABLETYPE=TAB
        </commandLine>
        <description>
          The command to use for this example.
        </description>
      </terminalInterface>

      <dataFiles>
        <dataFile path="assets/cubes.lis">
          <brief>The list of cubes to use</brief>
          <description>
            This is the input list of cubes used to create the overlap list
            which the statistics will be run on.
          </description>
          <parameterName>FROMLIST</parameterName>
        </dataFile>
        <dataFile path="assets/overlaps.lis">
          <brief>The file containing image overlap information</brief>
          <description>
            This is the file that contains information about the image overlaps.
            It can be obtained from the 
            <a href="../findimageoverlaps/findimageoverlaps.html"
              target="_blank">findimageoverlaps</a> application.
          </description>
          <parameterName>OVERLAPLIST</parameterName>
        </dataFile>
        <dataFile path="assets/stats.txt">
          <brief>The resulting stats file</brief>
          <description>
            The FULL output of overlapstats will be displayed and written to
            the filename provided in the TO option. You will notice that there
            are two different overlaps, which correspond with the two overlaps
            present in the overlap visualization image (see below).
          </description>
          <parameterName>TO</parameterName>
        </dataFile>
      </dataFiles>

      <inputImages>
        <image src="assets/image/cube1.jpg" width="494" height="494">
          <brief>First image</brief>
          <description>This is the first input image for overlapstats to use
          </description>
          <thumbnail caption="cube1.cub" src="assets/thumb/thumb1.jpg"
            width="75" height="300"/>
        </image>
        <image src="assets/image/cube2.jpg" width="493" height="493">
          <brief>Second image</brief>
          <description>This is the second input image
          </description>
          <thumbnail caption="cube2.cub" src="assets/thumb/thumb2.jpg"
            width="75" height="300"/>
        </image>
        <image src="assets/image/cube3.jpg" width="481" height="476">
          <brief>Third image</brief>
          <description>This is the third input image
          </description>
          <thumbnail caption="cube3.cub" src="assets/thumb/thumb3.jpg"
            width="75" height="300"/>
        </image>
        <image src="assets/image/overlaps.png" width="547" height="868">
          <brief>Overlap Visualization</brief>
          <description>This is not an input to the application, but it shows a
            visual representation of the overlapping regions of the three cubes.
            In this image, there are two overlapping regions.
          </description>
          <thumbnail caption="Overlapping Images"
            src="assets/thumb/thumb_overlaps.png" width="150" height="238"/>
        </image>
      </inputImages>
    </example>
  </examples>
</application>
